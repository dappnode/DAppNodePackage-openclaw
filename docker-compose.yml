version: "3.5"

services:
  gateway:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        UPSTREAM_VERSION: "latest"
    image: "gateway.openclaw.public.dappnode.eth:0.1.0"
    container_name: DAppNodePackage-gateway.openclaw.public.dappnode.eth
    restart: unless-stopped
    environment:
      HOME: /home/node
      TERM: xterm-256color
      NODE_ENV: production
      OPENCLAW_STATE_DIR: /home/node/.openclaw
    volumes:
      - "openclaw_data:/home/node/.openclaw"
      - "openclaw_workspace:/home/node/.openclaw/workspace"
    ports:
      - "18789:18789/tcp"
      - "18790:18790/tcp"
      - "7681:7681/tcp"
      - "8080:8080/tcp"
    security_opt:
      - no-new-privileges:true
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    command:
      - "node"
      - "dist/index.js"
      - "gateway"
      - "--bind"
      - "lan"
      - "--port"
      - "18789"
      - "--allow-unconfigured"
      - "--token"
      - "${GATEWAY_TOKEN:-openclaw}"

volumes:
  openclaw_data: {}
  openclaw_workspace: {}
